= üßπ Gu√≠a de Desmontaje del Taller - Prevenir Cargos Accidentales (15 minutos)
Luis Chavez <lachavez.olaya@gmail.com>, 2025
2025-09-11
:revdate: 2025-09-11
:linkattrs:
:ast: &ast;
:y: &#10003;
:n: &#10008;
:y: icon:check-sign[role="green"]
:n: icon:check-minus[role="red"]
:c: icon:file-text-alt[role="blue"]
:toc: auto
:toc-placement: auto
:toc-position: auto
:toc-title: Contenido de la Gu√≠a de Desmontaje
:toclevels: 3
:idprefix:
:idseparator: -
:sectanchors:
:icons: font
:source-highlighter: highlight.js
:highlightjs-theme: idea
:experimental:

[IMPORTANT]
====
üö® **CR√çTICO**: Esta gu√≠a te ayuda a limpiar adecuadamente todos los recursos de Confluent Cloud creados durante el taller para **prevenir cargos inesperados**.

**Ejecuta estos pasos inmediatamente despu√©s de completar el taller** para evitar costos continuos de los pools de c√≥mputo de Flink, las integraciones de cat√°logo de Tableflow y otros recursos facturables.
====

Esta gu√≠a proporciona instrucciones paso a paso para desmontar de forma segura todos los recursos del taller y evitar facturaci√≥n accidental.

toc::[]

== üéØ Objetivos del Desmontaje

Al final de este proceso de desmontaje, habr√°s:

* ‚úÖ Detenido todas las aplicaciones y pools de c√≥mputo de Flink en ejecuci√≥n.
* ‚úÖ Eliminado las integraciones de cat√°logo de Tableflow y las tablas materializadas.
* ‚úÖ Eliminado los Conectores de Origen HTTP (HTTP Source Connectors).
* ‚úÖ Limpiado las claves de API y las credenciales de acceso.
* ‚úÖ Eliminado los t√≥picos y el cl√∫ster de Kafka (opcional).
* ‚úÖ Eliminado el entorno del taller (opcional).
* ‚úÖ Verificado que no haya cargos en curso.

== ‚è±Ô∏è Distribuci√≥n del Tiempo

* **Limpieza de Alta Prioridad (Cr√≠tica para los Costos)**: 8 minutos
* **Limpieza de Recursos Est√°ndar**: 5 minutos
* **Verificaci√≥n Final**: 2 minutos

== üö® Limpieza de Alta Prioridad - Detener la Facturaci√≥n Inmediatamente (8 minutos)

Estos recursos generan los costos m√°s altos y deben ser eliminados **primero e inmediatamente**:

=== Detener Todas las Aplicaciones y Pools de C√≥mputo de Flink

[source,bash]
----
# 1. Listar y detener todas las sentencias/aplicaciones de Flink en ejecuci√≥n
confluent flink statement list

# Detener cada sentencia en ejecuci√≥n (reemplaza STATEMENT_ID con los IDs reales)
confluent flink statement stop $FLINK_STATEMENT_ID

# Eliminar todas las sentencias de Flink
confluent flink statement delete $FLINK_STATEMENT_ID

# 2. Detener y eliminar los pools de c√≥mputo de Flink
confluent flink compute-pool list

# Eliminar el pool de c√≥mputo
confluent flink compute-pool delete --force $FLINK_POOL_ID
----

[WARNING]
====
**Los pools de c√≥mputo de Flink cobran por CFU-horas incluso cuando est√°n inactivos**. Eliminarlos inmediatamente detiene todos los cargos.
====

=== Eliminar Recursos de Tableflow

[source,bash]
----
# Cargar variables de entorno
cd ./scripts/kafka
source .env

# 1. Deshabilitar Tableflow para todos los t√≥picos del taller
confluent tableflow topic disable crypto-prices --force --cluster $CC_KAFKA_CLUSTER
confluent tableflow topic disable price-alerts --force --cluster $CC_KAFKA_CLUSTER
confluent tableflow topic disable crypto-trends --force --cluster $CC_KAFKA_CLUSTER
confluent tableflow topic disable crypto-prices-exploded --force --cluster $CC_KAFKA_CLUSTER

# 2. Listar y verificar que los t√≥picos de Tableflow est√°n deshabilitados
confluent tableflow topic list --cluster $CC_KAFKA_CLUSTER

# 3. Eliminar las claves de API de Tableflow si fueron creadas
confluent api-key list
confluent api-key delete --force $TABLEFLOW_API_KEY
----

[WARNING]
====
**Las integraciones de cat√°logo de Tableflow incurren en costos de almacenamiento y c√≥mputo**. Elim√≠nalas inmediatamente despu√©s de detener la materializaci√≥n.
====

=== Verificar la Eliminaci√≥n de Recursos de Alta Prioridad

[source,bash]
----
# Verificar que los recursos de Flink han sido eliminados
confluent flink compute-pool list
confluent flink statement list

# Verificar que los recursos de Tableflow han sido eliminados
confluent tableflow topic list

# Salida esperada: Listas vac√≠as o "No resources found"
----

== üßπ Limpieza de Recursos Est√°ndar (5 minutos)

Despu√©s de detener los recursos de alto costo, limpia los componentes restantes:

=== Eliminar Conectores

[source,bash]
----
# Cargar variables de entorno
cd ./scripts/kafka
source .env

# Listar todos los conectores
confluent connect cluster list
confluent connect cluster list --cluster $CC_KAFKA_CLUSTER

# Eliminar el conector de origen HTTP
confluent connect cluster delete --cluster $CC_CONNECT_CLUSTER

# Verificar eliminaci√≥n
confluent connect cluster list --cluster $CC_KAFKA_CLUSTER
----

=== Limpiar Claves de API

[source,bash]
----
# Listar todas las claves de API en el entorno
confluent api-key list

# Eliminar las claves de API relacionadas con el taller (conserva solo las que necesites)
confluent api-key delete $KAFKA_API_KEY
confluent api-key delete $SCHEMA_REGISTRY_API_KEY

# Verificar las claves restantes
confluent api-key list
----

=== Eliminar T√≥picos de Kafka (Opcional)

[CAUTION]
====
[source,bash]
----
# Cargar variables de entorno
cd ./scripts/kafka
source .env

# Eliminar todos los t√≥picos del taller
confluent kafka topic delete crypto-prices --cluster $CC_KAFKA_CLUSTER
confluent kafka topic delete price-alerts --cluster $CC_KAFKA_CLUSTER
confluent kafka topic delete crypto-prices-exploded --cluster $CC_KAFKA_CLUSTER
confluent kafka topic delete crypto-trends --cluster $CC_KAFKA_CLUSTER
confluent kafka topic delete latest-prices --cluster $CC_KAFKA_CLUSTER

# Verificar eliminaci√≥n
confluent kafka topic list --cluster $CC_KAFKA_CLUSTER
----
====

=== Eliminar Cl√∫ster de Kafka (Opcional)

[NOTE]
====
**Los cl√∫steres B√°sicos son gratuitos**, pero puedes querer eliminarlos por organizaci√≥n. **Los cl√∫steres Est√°ndar/Dedicados incurren en cargos**.
====

[source,bash]
----
# Primero, verificar el tipo de cl√∫ster
confluent kafka cluster describe $CC_KAFKA_CLUSTER

# Si es un cl√∫ster Est√°ndar o Dedicado, elim√≠nalo inmediatamente:
confluent kafka cluster delete $CC_KAFKA_CLUSTER

# Para cl√∫steres B√°sicos (limpieza opcional):
confluent kafka cluster delete $CC_KAFKA_CLUSTER
----

== üóÇÔ∏è Limpieza del Entorno (Opcional)

=== Eliminar Entorno del Taller

[CAUTION]
====
**Eliminaci√≥n del Entorno**: Esto elimina todo el entorno y todos los recursos contenidos. Solo haz esto si creaste un entorno dedicado para el taller.
====

[source,bash]
----
# Listar entornos
confluent environment list

# Cambiar a un entorno diferente primero (usa tu entorno predeterminado)
confluent environment use <OTHER_ENV_ID>

# Eliminar el entorno del taller
confluent environment delete $CC_ENV_ID

# Verificar eliminaci√≥n
confluent environment list
----

== ‚úÖ Verificaci√≥n Final y Monitoreo de Costos (2 minutos)

=== Verificar que Todos los Recursos Fueron Eliminados

[TIP]
====
**Validaci√≥n R√°pida**: Usa el script de validaci√≥n automatizado para una revisi√≥n completa de los recursos:
[source,bash]
----
# Ejecutar el script de validaci√≥n automatizado
./scripts/setup/validate-teardown.sh
----
Este script proporciona una salida con colores, un an√°lisis detallado de los recursos y una evaluaci√≥n del impacto en los costos.
====

**Verificaci√≥n Manual** (si es necesario):

[source,bash]
----
# Comprobar si quedan recursos facturables
echo "üîç Comprobando recursos facturables restantes..."

# Recursos de Flink (deber√≠a estar vac√≠o)
echo "Pools de C√≥mputo de Flink:"
confluent flink compute-pool list

echo "Sentencias de Flink:"
confluent flink statement list

# Recursos de Tableflow (deber√≠a estar vac√≠o)
echo "Integraciones de Cat√°logo de Tableflow:"
confluent tableflow catalog-integration list

echo "T√≥picos de Tableflow:"
confluent tableflow topic list

# Conectores (deber√≠a estar vac√≠o o solo conectores no relacionados con el taller)
echo "Conectores:"
confluent connect connector list

# Cl√∫steres (los cl√∫steres B√°sicos son gratuitos, pero verifica si hay Est√°ndar/Dedicados)
echo "Cl√∫steres de Kafka:"
confluent kafka cluster list
----

=== Monitorear el Panel de Facturaci√≥n

[source,bash]
----
# Abrir la Consola de Confluent Cloud para verificar la facturaci√≥n
echo "üåê Por favor, verifica en la Consola de Confluent Cloud:"
echo "1. Ve a: https://confluent.cloud"
echo "2. Navega a: Billing & Payment ‚Üí Usage"
echo "3. Verifica: No hay cargos activos de Flink o Tableflow"
echo "4. Comprueba: Solo queda el cl√∫ster B√°sico (gratuito) o los recursos esperados"
----

== üí∞ Mejores Pr√°cticas para la Prevenci√≥n de Costos

=== Acciones Inmediatas Despu√©s del Taller

1. **Configura alertas de facturaci√≥n** en la Consola de Confluent Cloud.
2. **Revisa el uso diariamente** durante la primera semana despu√©s del taller.
3. **Elimina entornos no utilizados** regularmente.
4. **Monitorea el uso de claves de API** y elimina las que no se usen.

=== Gesti√≥n Continua de Costos

[TIP]
====
**Usa el script de validaci√≥n regularmente** para monitorear tus recursos de Confluent Cloud:
[source,bash]
----
# Realizar revisiones de costos semanales
./scripts/validate-teardown.sh
----
====

== üö® Script de Limpieza de Emergencia

Si necesitas eliminar todo r√°pidamente:

[source,bash]
----
# Script de limpieza de emergencia - √öSALO CON PRECAUCI√ìN
cat > ~/emergency-cleanup.sh << 'EOF'
#!/bin/bash

echo "üö® LIMPIEZA DE EMERGENCIA DE CONFLUENT CLOUD"
echo "¬°Esto eliminar√° TODOS los recursos del taller!"
read -p "Est√°s seguro? Escribe 'DELETE' para continuar: " confirm

if [ "$confirm" != "DELETE" ]; then
    echo "Limpieza cancelada."
    exit 1
fi

echo "üßπ Iniciando limpieza de emergencia..."

# Detener y eliminar todos los recursos de Flink
echo "Limpiando recursos de Flink..."
for statement in $(confluent flink statement list --output json | jq -r '.[].name' 2>/dev/null); do
    confluent flink statement delete "$statement" --force
done

for pool in $(confluent flink compute-pool list --output json | jq -r '.[].id' 2>/dev/null); do
    confluent flink compute-pool delete "$pool" --force
done

# Eliminar todos los recursos de Tableflow
echo "Limpiando recursos de Tableflow..."
for topic in $(confluent tableflow topic list --output json | jq -r '.[].name' 2>/dev/null); do
    confluent tableflow topic delete "$topic" --force
done

for catalog in $(confluent tableflow catalog-integration list --output json | jq -r '.[].id' 2>/dev/null); do
    confluent tableflow catalog-integration delete "$catalog" --force
done

# Eliminar conectores
echo "Limpiando conectores..."
for connector in $(confluent connect connector list --output json | jq -r '.[].name' 2>/dev/null); do
    confluent connect connector delete "$connector"
done

echo "‚úÖ ¬°Limpieza de emergencia completada!"
echo "üåê Por favor, verifica en la Consola de Confluent Cloud que todos los recursos han sido eliminados."
EOF

chmod +x ~/emergency-cleanup.sh
----

== üìã Lista de Verificaci√≥n del Desmontaje

Antes de considerar el desmontaje completo, verifica:

**Alta Prioridad (Cr√≠tica para los Costos)**:
- [ ] Todos los pools de c√≥mputo de Flink eliminados
- [ ] Todas las aplicaciones/sentencias de Flink detenidas y eliminadas
- [ ] Todas las integraciones de cat√°logo de Tableflow eliminadas
- [ ] Todas las tablas materializadas de Tableflow eliminadas

**Limpieza Est√°ndar**:
- [ ] Conectores de Origen HTTP eliminados
- [ ] Claves de API del taller eliminadas
- [ ] T√≥picos del taller eliminados (si se desea)
- [ ] Cl√∫ster de Kafka eliminado (si es de nivel Est√°ndar/Dedicado)

**Verificaci√≥n**:
- [ ] El panel de facturaci√≥n no muestra cargos inesperados
- [ ] El script de monitoreo de costos se ejecuta sin problemas
- [ ] Se confirma la eliminaci√≥n de todos los recursos del taller

== üîß Soluci√≥n de Problemas de Desmontaje

=== No se puede eliminar el Pool de C√≥mputo de Flink

[source,bash]
----
# Forzar la detenci√≥n de todas las aplicaciones primero
confluent flink statement list
confluent flink statement stop <STATEMENT_ID> --force

# Esperar unos minutos, luego intentar eliminar el pool
confluent flink compute-pool delete <POOL_ID> --force
----

=== No se puede eliminar la Integraci√≥n de Cat√°logo de Tableflow

[source,bash]
----
# Eliminar todas las tablas materializadas primero
confluent tableflow topic list
confluent tableflow topic delete <TABLE_NAME> --force

# Eliminar claves de API
confluent tableflow api-key list
confluent tableflow api-key delete <API_KEY>

# Luego eliminar la integraci√≥n de cat√°logo
confluent tableflow catalog-integration delete <CATALOG_ID> --force
----

=== Falla la Eliminaci√≥n del Conector

[source,bash]
----
# Verificar el estado del conector
confluent connect connector describe <CONNECTOR_NAME>

# Forzar la eliminaci√≥n si est√° atascado
confluent connect connector delete <CONNECTOR_NAME> --force

# Si sigue fallando, contacta al soporte con el ID del conector
----

=== Aparecen Cargos Inesperados

1. **Ejecuta inmediatamente el script de limpieza de emergencia**
2. **Revisa la secci√≥n de facturaci√≥n en la Consola de Confluent Cloud**
3. **Contacta al Soporte de Confluent** con tu ID de organizaci√≥n
4. **Documenta todos los recursos** que crees que deber√≠an ser eliminados

== üìû Soporte y Recursos

=== Obtener Ayuda

* **Consola de Confluent Cloud**: https://confluent.cloud/settings/billing
* **Soporte de Confluent**: https://support.confluent.io
* **Slack de la Comunidad**: https://confluentcommunity.slack.com

=== Recursos de Estimaci√≥n de Costos

* **Precios de Confluent Cloud**: https://www.confluent.io/confluent-cloud/pricing/
* **Calculadora de Precios de Flink**: Disponible en la Consola de Confluent Cloud
* **Precios de Tableflow**: Basado en el uso de almacenamiento y c√≥mputo

== üìö Recursos Adicionales

* https://docs.confluent.io/cloud/current/billing/overview.html[Resumen de Facturaci√≥n de Confluent Cloud]
* https://docs.confluent.io/confluent-cli/current/command-reference/[Referencia del CLI de Confluent]
* https://docs.confluent.io/cloud/current/flink/[Flink para Confluent Cloud]
* https://docs.confluent.io/cloud/current/tableflow/[Documentaci√≥n de Tableflow]

---

[IMPORTANT]
====
üéâ **¬°Taller Completado!**

Has completado con √©xito el taller de Confluent Cloud y has limpiado adecuadamente todos los recursos.

**Recuerda**: Siempre ejecuta este proceso de desmontaje despu√©s de cualquier experimentaci√≥n en Confluent Cloud para prevenir cargos inesperados.
====
